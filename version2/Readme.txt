Вторая версия контроллера ванной комнаты.

Силовая часть контроллера реализуется с использованием модулей реле (обычных и твердотельных), на отдельной заводской плате.
Дисплей не устанавливается на данные контроллер.
Проверка, настройка и управление будет возможно по UART через Bluetooth модуль HС-06  Bluetooth 2.0

Контроллер будет иметь набор комманд, через которые можно настроить его, а также узнать статус и просмотреть сообщения.

В контроллер вшит загрузчик (Bootloader), помогающий обновить прошивку через UART.

Контроллер подключается к ПК для взаимодействия через UART.

Датчики:
- 1 - 2 датчика движения
- 1 магнитный датчик двери (геркон)
- 1 датчик влажности +  температуры  (DHT22)

Управление :
- 2 канала управление светом (твердотельное реле с опто-развязкой)
- 1 канал вентилятор         (твердотельное реле с опто-развязкой)
- 1 канал включения музыки   (электромагнитное реле с опто-развязкой)
- 1 порт управления Bluetooth модулем


Микроконтроллер : ATMEGA328p
Частота : 12 Mhz

UART
PD0 RXD
PD1 TXD

Crystal
PB6 XTAL1
PB7 XTAL2

Reset
PC6

Free pins
PD2  INT0
PD3  INT1
PD4
PD5
PD6  A
PD7  A

PB0
PB1
PB2
PB3
PB4
PB5

PC0  A
PC1  A
PC2  A
PC3  A
PC4  A
PC5  A




Прошивка

Фьюзы
avrdude.exe -p m328p -c usbasp -U lfuse:w:0xC7:m -U hfuse:w:0xD2:m -U efuse:w:0x07:m
не используй Brown-Out detection - т.к. бутлоадер не работал

Бутлодер
avrdude.exe -p m328p -c usbasp -U flash:w:chip45boot2_atmega328p_uart0_v2.9Q.hex

Бутлоадер работает через UART, 19200 один стоповый бит, нету бита чётности

Сопряжение с контроллером по UART также на 19200 с одним стоповым битом без бита чётности
Используется bluetooth модуль HC-06. Скорость устанавливается с помощью AT комманд проводным подключением.
Его скорость по умолчанию 9600 
Комманды для настройки модуля:

версия
AT+VERSION

Установка имени модуля
AT+NAME:MCU-BATH-105

Установка пароля
AT+PSWD:"105105"

установка скорости 19200
AT+UART:19200,0,0

